var com = com || {};
com.ama = com.ama || {};

com.ama.atm = function(config) {
    var defaultConfig = {
        trip: {
            URL:"https://www.checkmytrip.com/cmt/apf/mcmtng/",
            SITE:"NCMTNCMT",
            OCTX:"TCUAT"
        },
        reco: {
            URL:"https://www.checkmytrip.com/cmt/apf/recoengine/",
            SITE:"NCMTNCMT",
            OCTX:"TCUAT"
        },
        aetm:{
            URL:"https://aetm-me1.dev.amadeus.net/aetm/apf/aetmme/",
            SITE:"YCGAYCGA",
            OCTX:"MOBILE"
        },
        APPVERSION : "V5",
        LANGUAGE : "GB"
    };
    var config = config ?config :defaultConfig;    
    var xhr = function(method, headers, url, req, rCb, sCb) { 
        var xhr = new XMLHttpRequest();
        xhr.onreadystatechange = function() {
            if(sCb)
                sCb(xhr.readyState);
            if(xhr.readyState == 4 && xhr.status == 200)
                if(xhr.responseXML)
                    rCb(xhr.responseXML)
                else
                    rCb(xhr.responseText);
        }
        xhr.open(method, url);
        if(headers) {
            for(var key in headers) {
                if(headers.hasOwnProperty(key)) {
                    xhr.setRequestHeader(key, headers[key]);
                }
            }
        }
        if(method==='POST') {
            xhr.send(req);  
        } else {
            xhr.send();      
        }
    };
    var reqUrl  = function(action, req) {
      var url;
      if(req.reco)
        url = config.reco.URL+action+"?SITE="+config.reco.SITE+"&LANGUAGE="+config.LANGUAGE+"&OCTX="+config.reco.OCTX+"&APPVERSION="+config.APPVERSION;
      else if(req.aetm)
        url = config.aetm.URL+action+"?SITE="+config.aetm.SITE+"&LANGUAGE="+config.LANGUAGE+"&OCTX="+config.aetm.OCTX+"&APPVERSION="+config.APPVERSION;
      else
        url = config.trip.URL+action+"?SITE="+config.trip.SITE+"&LANGUAGE="+config.LANGUAGE+"&OCTX="+config.trip.OCTX+"&APPVERSION="+config.APPVERSION;
      return url;
    };   
    var setData = function(key, value){
        var updateStorage = false;
        if(localStorage.getItem(key))
            updateStorage = true;                
        if(key !=null){
            com.ama.atm.data = com.ama.atm.data || {}
            com.ama.atm.data[key] = value;
            if(updateStorage)
                localStorage.setItem(key, JSON.stringify(value));        
        }
    };
    var getData = function(key) {
        var result;
        if(key) {
            if(result=localStorage.getItem(key))
                result = JSON.parse(result);
            else 
                result = com.ama.atm.data[key];
            if(result && !com.ama.atm.data[key])
                result.cached = true;            
        }
        return result;
    };
    var clearData = function(){
        localStorage.clear();
        com.ama.atm.data = {};
    };

    var isApp = function() {
        var app = document.URL.indexOf( 'http://' ) === -1 && document.URL.indexOf( 'https://' ) === -1;
        return app;
    };
    var tripdata = {"model":{"airData":{"allSegmentsElectronicTicketing":true,"baggageAllowanceException":false,"justification":null,"lowestFare":null},"airItineraries":[{"airline":null,"airlines":[{"checkinDuration":null,"checkinUrl":"","code":"7S","inputMap":null,"isSSCI":null,"isTCCI":null,"mobileCheckinUrl":"","name":"Amadeus Pdf 7S","reference":null}],"allSegmentsElectronicTicketing":true,"allowElementModif":false,"arrivalDate":{"GMTDate":"2015/11/24 08:20:00 GMT+0000","GMTTimeStamp":1448353200000,"date":"2015/11/24 09:20:00 GMT+0000","formatDateAsYYYYMM":"201511","formatDateAsYYYYMMdd":"20151124","formatDateTimeAsSQLFormat":"2015-11-24 09:20:00","formatDateTimeAsYYYYMMddHHMM":"201511240920","formatTimeAsHHMM":"0920","json":"new Date(2015,10,24,9,20,0)","jsonForTime":"new Date(1970,0,1,9,20,0)","newDate":false,"timeID":"GMT","timeStamp":1448356800000},"arrivalLocation":{"airportGuideAvailable":true,"airportMapAvailable":true,"cityCode":"NCE","cityName":"Nice","countryCode":"FR","countryName":"France","currency":{"code":"EUR","name":"","symbol":"€"},"destinationGuideAvailable":true,"formattedCityName":"Nice","latitude":"4370313","locationCode":"NCE","locationCodeType":null,"locationName":"Cote D'Azur","locationType":null,"longitude":"726608","photoURL":null,"stateCode":null,"stateName":null,"subwayMapAvailable":false,"themes":null,"type":null},"arrivalTerminal":"2","baggageAllowanceException":false,"boolFlown":false,"checkInDate":null,"checkOutDate":null,"confirmationNumber":null,"departureDate":{"GMTDate":"2015/11/24 07:00:00 GMT+0000","GMTTimeStamp":1448348400000,"date":"2015/11/24 08:00:00 GMT+0000","formatDateAsYYYYMM":"201511","formatDateAsYYYYMMdd":"20151124","formatDateTimeAsSQLFormat":"2015-11-24 08:00:00","formatDateTimeAsYYYYMMddHHMM":"201511240800","formatTimeAsHHMM":"0800","json":"new Date(2015,10,24,8,0,0)","jsonForTime":"new Date(1970,0,1,8,0,0)","newDate":false,"timeID":"GMT","timeStamp":1448352000000},"departureLocation":{"airportGuideAvailable":true,"airportMapAvailable":true,"cityCode":"PAR","cityName":"Paris","countryCode":"FR","countryName":"France","currency":{"code":"EUR","name":"","symbol":"€"},"destinationGuideAvailable":true,"formattedCityName":"Paris","latitude":"4885341","locationCode":"CDG","locationCodeType":null,"locationName":"Charles De Gaulle","locationType":null,"longitude":"234880","photoURL":null,"stateCode":null,"stateName":null,"subwayMapAvailable":true,"themes":null,"type":null},"departureTerminal":"2F","endAddress":null,"etrSegment":false,"initialElement":false,"invalidArrivalTime":false,"invalidDepartureTime":false,"isChanges":false,"itemId":1,"lineNumber":2,"listRIZRemarks":[],"listRemarks":[],"nbrOfSegements":1,"nbrOfStops":0,"outOfPolicy":null,"partyCount":0,"remark":null,"segmentTatoo":null,"segments":[{"activityDescription":null,"activityName":null,"afterSellRbdStatus":{"code":"HK","message":null,"messageKey":"tx_pltg_text_ConfirmedStatus","onRequest":false,"waitlisted":false},"aircraftGuideAvailable":true,"airline":{"checkinDuration":null,"checkinUrl":"","code":"7S","inputMap":null,"isSSCI":null,"isTCCI":null,"mobileCheckinUrl":"","name":"Amadeus Pdf 7S","reference":null},"arrivalDate":{"GMTDate":"2015/11/24 08:20:00 GMT+0000","GMTTimeStamp":1448353200000,"date":"2015/11/24 09:20:00 GMT+0000","formatDateAsYYYYMM":"201511","formatDateAsYYYYMMdd":"20151124","formatDateTimeAsSQLFormat":"2015-11-24 09:20:00","formatDateTimeAsYYYYMMddHHMM":"201511240920","formatTimeAsHHMM":"0920","json":"new Date(2015,10,24,9,20,0)","jsonForTime":"new Date(1970,0,1,9,20,0)","newDate":false,"timeID":"GMT","timeStamp":1448356800000},"arrivalLocation":{"airportGuideAvailable":true,"airportMapAvailable":true,"cityCode":"NCE","cityName":"Nice","countryCode":"FR","countryName":"France","currency":{"code":"EUR","name":"","symbol":"€"},"destinationGuideAvailable":true,"formattedCityName":"Nice","latitude":"4370313","locationCode":"NCE","locationCodeType":null,"locationName":"Cote D'Azur","locationType":null,"longitude":"726608","photoURL":null,"stateCode":null,"stateName":null,"subwayMapAvailable":false,"themes":null,"type":null},"arrivalTerminal":"2","baggageAllowance":null,"baggageAllowanceException":false,"blacklisted":false,"bookingChannel":null,"cabinClass":null,"cabinStatuses":[],"cabins":[{"code":"E","name":"Economy","rbd":"Y","rbdStatus":null,"statusCode":true}],"cancel":null,"changeOfEquipment":false,"checkInDate":null,"checkOutDate":null,"checkinInfo":null,"confirmationNumber":null,"departureDate":{"GMTDate":"2015/11/24 07:00:00 GMT+0000","GMTTimeStamp":1448348400000,"date":"2015/11/24 08:00:00 GMT+0000","formatDateAsYYYYMM":"201511","formatDateAsYYYYMMdd":"20151124","formatDateTimeAsSQLFormat":"2015-11-24 08:00:00","formatDateTimeAsYYYYMMddHHMM":"201511240800","formatTimeAsHHMM":"0800","json":"new Date(2015,10,24,8,0,0)","jsonForTime":"new Date(1970,0,1,8,0,0)","newDate":false,"timeID":"GMT","timeStamp":1448352000000},"departureLocation":{"airportGuideAvailable":true,"airportMapAvailable":true,"cityCode":"PAR","cityName":"Paris","countryCode":"FR","countryName":"France","currency":{"code":"EUR","name":"","symbol":"€"},"destinationGuideAvailable":true,"formattedCityName":"Paris","latitude":"4885341","locationCode":"CDG","locationCodeType":null,"locationName":"Charles De Gaulle","locationType":null,"longitude":"234880","photoURL":null,"stateCode":null,"stateName":null,"subwayMapAvailable":true,"themes":null,"type":null},"departureTerminal":"2F","elapsedFlyingTime":null,"electronicTicketing":true,"endAddress":null,"equipmentCode":"321","equipmentName":"Airbus Industrie A321","etrSegment":false,"fareBasis":null,"firstCabinStatuses":[],"flightNumber":"1068","flightTime":4800000,"flightTimeInMillisecond":4800000,"formattedFlightTime":"1:20","invalidArrivalTime":false,"invalidDepartureTime":false,"isTrn":null,"itemId":1,"jsonFlightTime":"new Date(1970,0,1,1,20,0)","lastCheckinTimeBeforeDeparture":null,"legs":null,"lineNumber":2,"listRIZRemarks":[],"listRemarks":[],"meals":[],"nbrOfSeats":1,"nbrOfStops":0,"nva":null,"nvb":null,"onTimePerformance":null,"opAirline":null,"opFlag":null,"opFlightNumber":null,"partyCount":0,"performanceIndicator":null,"reconfirmable":true,"remark":null,"seatMapAvailable":false,"segmentTatoo":1,"segments":null,"serviceMeals":[],"shuttle":false,"startAddress":null,"status":"HK","statusCode":null,"techStops":null,"ticketNumber":null,"title":null,"totalPrice":null,"trafficRestriction":false,"travelType":null,"travellerPreferences":null,"travellerTypesInfos":null,"type":"AIR"}],"startAddress":null,"status":null,"statusCode":null,"stops":[],"title":null,"totalPrice":null,"type":"AIR"},{"airline":null,"airlines":[{"checkinDuration":null,"checkinUrl":"","code":"7S","inputMap":null,"isSSCI":null,"isTCCI":null,"mobileCheckinUrl":"","name":"Amadeus Pdf 7S","reference":null}],"allSegmentsElectronicTicketing":true,"allowElementModif":false,"arrivalDate":{"GMTDate":"2015/12/13 00:05:00 GMT+0000","GMTTimeStamp":1449965100000,"date":"2015/12/13 01:05:00 GMT+0000","formatDateAsYYYYMM":"201512","formatDateAsYYYYMMdd":"20151213","formatDateTimeAsSQLFormat":"2015-12-13 01:05:00","formatDateTimeAsYYYYMMddHHMM":"201512130105","formatTimeAsHHMM":"0105","json":"new Date(2015,11,13,1,5,0)","jsonForTime":"new Date(1970,0,1,1,5,0)","newDate":false,"timeID":"GMT","timeStamp":1449968700000},"arrivalLocation":{"airportGuideAvailable":true,"airportMapAvailable":true,"cityCode":"PAR","cityName":"Paris","countryCode":"FR","countryName":"France","currency":{"code":"EUR","name":"","symbol":"€"},"destinationGuideAvailable":true,"formattedCityName":"Paris","latitude":"4885341","locationCode":"CDG","locationCodeType":null,"locationName":"Charles De Gaulle","locationType":null,"longitude":"234880","photoURL":null,"stateCode":null,"stateName":null,"subwayMapAvailable":true,"themes":null,"type":null},"arrivalTerminal":"1","baggageAllowanceException":false,"boolFlown":false,"checkInDate":null,"checkOutDate":null,"confirmationNumber":null,"departureDate":{"GMTDate":"2015/12/12 23:05:00 GMT+0000","GMTTimeStamp":1449961500000,"date":"2015/12/13 00:05:00 GMT+0000","formatDateAsYYYYMM":"201512","formatDateAsYYYYMMdd":"20151213","formatDateTimeAsSQLFormat":"2015-12-13 12:05:00","formatDateTimeAsYYYYMMddHHMM":"201512130005","formatTimeAsHHMM":"0005","json":"new Date(2015,11,13,0,5,0)","jsonForTime":"new Date(1970,0,1,0,5,0)","newDate":false,"timeID":"GMT","timeStamp":1449965100000},"departureLocation":{"airportGuideAvailable":true,"airportMapAvailable":true,"cityCode":"NCE","cityName":"Nice","countryCode":"FR","countryName":"France","currency":{"code":"EUR","name":"","symbol":"€"},"destinationGuideAvailable":true,"formattedCityName":"Nice","latitude":"4370313","locationCode":"NCE","locationCodeType":null,"locationName":"Cote D'Azur","locationType":null,"longitude":"726608","photoURL":null,"stateCode":null,"stateName":null,"subwayMapAvailable":false,"themes":null,"type":null},"departureTerminal":"1","endAddress":null,"etrSegment":false,"initialElement":false,"invalidArrivalTime":false,"invalidDepartureTime":false,"isChanges":false,"itemId":2,"lineNumber":3,"listRIZRemarks":[],"listRemarks":[],"nbrOfSegements":1,"nbrOfStops":0,"outOfPolicy":null,"partyCount":0,"remark":null,"segmentTatoo":null,"segments":[{"activityDescription":null,"activityName":null,"afterSellRbdStatus":{"code":"HK","message":null,"messageKey":"tx_pltg_text_ConfirmedStatus","onRequest":false,"waitlisted":false},"aircraftGuideAvailable":true,"airline":{"checkinDuration":null,"checkinUrl":"","code":"7S","inputMap":null,"isSSCI":null,"isTCCI":null,"mobileCheckinUrl":"","name":"Amadeus Pdf 7S","reference":null},"arrivalDate":{"GMTDate":"2015/12/13 00:05:00 GMT+0000","GMTTimeStamp":1449965100000,"date":"2015/12/13 01:05:00 GMT+0000","formatDateAsYYYYMM":"201512","formatDateAsYYYYMMdd":"20151213","formatDateTimeAsSQLFormat":"2015-12-13 01:05:00","formatDateTimeAsYYYYMMddHHMM":"201512130105","formatTimeAsHHMM":"0105","json":"new Date(2015,11,13,1,5,0)","jsonForTime":"new Date(1970,0,1,1,5,0)","newDate":false,"timeID":"GMT","timeStamp":1449968700000},"arrivalLocation":{"airportGuideAvailable":true,"airportMapAvailable":true,"cityCode":"PAR","cityName":"Paris","countryCode":"FR","countryName":"France","currency":{"code":"EUR","name":"","symbol":"€"},"destinationGuideAvailable":true,"formattedCityName":"Paris","latitude":"4885341","locationCode":"CDG","locationCodeType":null,"locationName":"Charles De Gaulle","locationType":null,"longitude":"234880","photoURL":null,"stateCode":null,"stateName":null,"subwayMapAvailable":true,"themes":null,"type":null},"arrivalTerminal":"1","baggageAllowance":null,"baggageAllowanceException":false,"blacklisted":false,"bookingChannel":null,"cabinClass":null,"cabinStatuses":[],"cabins":[{"code":"E","name":"Economy","rbd":"Y","rbdStatus":null,"statusCode":true}],"cancel":null,"changeOfEquipment":false,"checkInDate":null,"checkOutDate":null,"checkinInfo":null,"confirmationNumber":null,"departureDate":{"GMTDate":"2015/12/12 23:05:00 GMT+0000","GMTTimeStamp":1449961500000,"date":"2015/12/13 00:05:00 GMT+0000","formatDateAsYYYYMM":"201512","formatDateAsYYYYMMdd":"20151213","formatDateTimeAsSQLFormat":"2015-12-13 12:05:00","formatDateTimeAsYYYYMMddHHMM":"201512130005","formatTimeAsHHMM":"0005","json":"new Date(2015,11,13,0,5,0)","jsonForTime":"new Date(1970,0,1,0,5,0)","newDate":false,"timeID":"GMT","timeStamp":1449965100000},"departureLocation":{"airportGuideAvailable":true,"airportMapAvailable":true,"cityCode":"NCE","cityName":"Nice","countryCode":"FR","countryName":"France","currency":{"code":"EUR","name":"","symbol":"€"},"destinationGuideAvailable":true,"formattedCityName":"Nice","latitude":"4370313","locationCode":"NCE","locationCodeType":null,"locationName":"Cote D'Azur","locationType":null,"longitude":"726608","photoURL":null,"stateCode":null,"stateName":null,"subwayMapAvailable":false,"themes":null,"type":null},"departureTerminal":"1","elapsedFlyingTime":null,"electronicTicketing":true,"endAddress":null,"equipmentCode":"320","equipmentName":"Airbus Industrie A320","etrSegment":false,"fareBasis":null,"firstCabinStatuses":[],"flightNumber":"1177","flightTime":3600000,"flightTimeInMillisecond":3600000,"formattedFlightTime":"1:00","invalidArrivalTime":false,"invalidDepartureTime":false,"isTrn":null,"itemId":2,"jsonFlightTime":"new Date(1970,0,1,1,0,0)","lastCheckinTimeBeforeDeparture":null,"legs":null,"lineNumber":3,"listRIZRemarks":[],"listRemarks":[],"meals":[],"nbrOfSeats":1,"nbrOfStops":0,"nva":null,"nvb":null,"onTimePerformance":null,"opAirline":null,"opFlag":null,"opFlightNumber":null,"partyCount":0,"performanceIndicator":null,"reconfirmable":true,"remark":null,"seatMapAvailable":false,"segmentTatoo":2,"segments":null,"serviceMeals":[],"shuttle":false,"startAddress":null,"status":"HK","statusCode":null,"techStops":null,"ticketNumber":null,"title":null,"totalPrice":null,"trafficRestriction":false,"travelType":null,"travellerPreferences":null,"travellerTypesInfos":null,"type":"AIR"}],"startAddress":null,"status":null,"statusCode":null,"stops":[],"title":null,"totalPrice":null,"type":"AIR"}],"airOfferBeans":null,"airTaxis":null,"airlineRecLocs":[{"airline":{"checkinDuration":null,"checkinUrl":null,"code":"7S","inputMap":null,"isSSCI":null,"isTCCI":null,"mobileCheckinUrl":null,"name":"Amadeus Pdf 7S","reference":null},"flightNumber":"1068","recLoc":"2ZX97P"}],"alreadyApproversData":null,"approvalExpiryDate":null,"approvers":null,"cancelAllowed":"false","cars":null,"completed":false,"creationDate":{"GMTDate":null,"GMTTimeStamp":-1,"date":"2015/11/02 09:31:00 GMT+0000","formatDateAsYYYYMM":"201511","formatDateAsYYYYMMdd":"20151102","formatDateTimeAsSQLFormat":"2015-11-02 09:31:00","formatDateTimeAsYYYYMMddHHMM":"201511020931","formatTimeAsHHMM":"0931","json":"new Date(2015,10,2,9,31,0)","jsonForTime":"new Date(1970,0,1,9,31,0)","newDate":false,"timeID":"GMT","timeStamp":1446456660000},"cruises":null,"endDate":{"GMTDate":"2015/12/13 00:05:00 GMT+0000","GMTTimeStamp":1449965100000,"date":"2015/12/13 01:05:00 GMT+0000","formatDateAsYYYYMM":"201512","formatDateAsYYYYMMdd":"20151213","formatDateTimeAsSQLFormat":"2015-12-13 01:05:00","formatDateTimeAsYYYYMMddHHMM":"201512130105","formatTimeAsHHMM":"0105","json":"new Date(2015,11,13,1,5,0)","jsonForTime":"new Date(1970,0,1,1,5,0)","newDate":false,"timeID":"GMT","timeStamp":1449968700000},"errors":null,"etrActivitySegments":null,"etrEatSegments":null,"etrMeetingSegments":null,"etrMoveSegments":null,"etrOtherSleepSegments":null,"etrServiceSegments":null,"etrTaxiSegments":null,"etrTransferSegments":null,"generalRemarks":[],"geoInfo":{"activityDropOff":null,"activityPickUp":null,"airTaxiDropOff":null,"airTaxiPickUp":null,"arrivalAirport":{"latitude":"43.66669","longitude":"7.21392"},"arrivalCity":{"latitude":"43.70313","longitude":"7.26608"},"carDropOff":null,"carPickUp":null,"cruiseDropOff":null,"cruisePickUp":null,"departureAirport":{"latitude":"49.00392","longitude":"2.52816"},"departureCity":{"latitude":"48.85341","longitude":"2.34880"},"enableMapDisplay":true,"enableMapDisplayAsTripTool":true,"groundDropOff":null,"groundPickUp":null,"hotel":null,"miscServPickUp":null,"otherSleep":null},"grounds":null,"hotelOfferBeans":null,"hotels":null,"infos":[],"initialOfficeId":"NCE1A0955","insurance":null,"listElementTicket":{"arrangementType":"OK","expiryDate":{"GMTDate":null,"GMTTimeStamp":-1,"date":"2015/11/02 00:00:00 GMT+0000","formatDateAsYYYYMM":"201511","formatDateAsYYYYMMdd":"20151102","formatDateTimeAsSQLFormat":"2015-11-02 12:00:00","formatDateTimeAsYYYYMMddHHMM":"201511020000","formatTimeAsHHMM":"0000","json":"new Date(2015,10,2,0,0,0)","jsonForTime":"new Date(1970,0,1,0,0,0)","newDate":false,"timeID":"GMT","timeStamp":1446422400000},"expiryTime":"0000","segmentLineNo":6,"tattoo":5,"ticketingOfficeId":"NCE1A0955","ticketingType":"TICKETING_ELEMENT"},"listFareFromRemarks":null,"listTickets":{"displayErrorITRSection":false,"displayEticketNumbers":false,"displayViewCloseLink":false,"etktViewEnabled":false,"hasAllTicketDetails":false,"listAirTicketInformation":null,"listAirTicketInformationSize":0,"listTicketInformation":null,"listTicketInformationSize":0,"trainTicketsMap":null},"misc":null,"nextApprovalsData":null,"numberOfAir":2,"numberOfAirTaxi":0,"numberOfCar":0,"numberOfCruise":0,"numberOfGround":0,"numberOfHotel":0,"numberOfInsurance":0,"numberOfMisc":0,"numberOfRail":0,"numberOfTour":0,"offerOnly":false,"orderedTravellers":[1],"parameters":{"infotrieverPartnerId":"600000000000052","siteRTShowPrices":true,"enableTripTitle":true,"infotrieverMD5Key":"q1w2e3","dispEtktTourcode":true,"siteBoolBlueLane":false,"enableTripComment":true,"TARefLink":"","dispEtktAirline":true,"siteDisplayAircraft":true,"siteDisplayContentLinks":false,"infotrieverUrl":"https://my.infotriever.com/portal","dispPaxFreqFlyerNumbers":true,"dispBagsLink":false,"enableAddToCalendar":true,"enableFightChat":true,"bagsLink":"https://bags.amadeus.com?r={0}&n={1}","dispEtktIssueDate":true,"dispPaxAPIS":false,"shareFBAppId":"993507367335868","dispPaxRemarks":true,"dispEtktEndorsement":true,"enablePDFDownload":true,"HTTPSForPDFStatics":false,"FULL_TIME_FMT_JAVA":"HH:mm","dispPaxFreqGuestNumbers":false,"airlineLogoBaseUrl":"/aria/3.2/img/airlineLogo/","infotrieverProductName":"Aergo","TALogoURL":"","charset":"iso-8859-1","displayOfferPrice":true,"ociUrlEnabled":true,"siteDisplInfLastName":true,"dispPaxETickets":true,"dispSeatMap":true,"dispAncillaryServices":true,"dispPaxIdentityInfo":true},"pnrContainingEtr":false,"pnrContainingGDS":true,"preview":{"airline":null,"arrivalDate":{"GMTDate":"2015/11/24 08:20:00 GMT+0000","GMTTimeStamp":1448353200000,"date":"2015/11/24 09:20:00 GMT+0000","formatDateAsYYYYMM":"201511","formatDateAsYYYYMMdd":"20151124","formatDateTimeAsSQLFormat":"2015-11-24 09:20:00","formatDateTimeAsYYYYMMddHHMM":"201511240920","formatTimeAsHHMM":"0920","json":"new Date(2015,10,24,9,20,0)","jsonForTime":"new Date(1970,0,1,9,20,0)","newDate":false,"timeID":"GMT","timeStamp":1448356800000},"arrivalLocation":{"airportGuideAvailable":true,"airportMapAvailable":true,"cityCode":"NCE","cityName":"Nice","countryCode":"FR","countryName":"France","currency":{"code":"EUR","name":"","symbol":"€"},"destinationGuideAvailable":true,"formattedCityName":"Nice","latitude":"4370313","locationCode":"NCE","locationCodeType":null,"locationName":"Cote D'Azur","locationType":null,"longitude":"726608","photoURL":null,"stateCode":null,"stateName":null,"subwayMapAvailable":false,"themes":null,"type":null},"arrivalTerminal":null,"checkInDate":null,"checkOutDate":null,"confirmationNumber":null,"departureDate":{"GMTDate":"2015/11/24 07:00:00 GMT+0000","GMTTimeStamp":1448348400000,"date":"2015/11/24 08:00:00 GMT+0000","formatDateAsYYYYMM":"201511","formatDateAsYYYYMMdd":"20151124","formatDateTimeAsSQLFormat":"2015-11-24 08:00:00","formatDateTimeAsYYYYMMddHHMM":"201511240800","formatTimeAsHHMM":"0800","json":"new Date(2015,10,24,8,0,0)","jsonForTime":"new Date(1970,0,1,8,0,0)","newDate":false,"timeID":"GMT","timeStamp":1448352000000},"departureLocation":{"airportGuideAvailable":true,"airportMapAvailable":true,"cityCode":"PAR","cityName":"Paris","countryCode":"FR","countryName":"France","currency":{"code":"EUR","name":"","symbol":"€"},"destinationGuideAvailable":true,"formattedCityName":"Paris","latitude":"4885341","locationCode":"CDG","locationCodeType":null,"locationName":"Charles De Gaulle","locationType":null,"longitude":"234880","photoURL":null,"stateCode":null,"stateName":null,"subwayMapAvailable":true,"themes":null,"type":null},"departureTerminal":null,"endAddress":null,"etrSegment":false,"invalidArrivalTime":false,"invalidDepartureTime":false,"itemId":null,"listRIZRemarks":[],"listRemarks":[],"partyCount":0,"remark":null,"segmentTatoo":null,"segments":null,"startAddress":null,"status":null,"statusCode":null,"title":null,"totalPrice":null,"type":null},"recLoc":"2ZX97P","responsibleOfficeId":"NCE1A0955","startDate":{"GMTDate":"2015/11/24 07:00:00 GMT+0000","GMTTimeStamp":1448348400000,"date":"2015/11/24 08:00:00 GMT+0000","formatDateAsYYYYMM":"201511","formatDateAsYYYYMMdd":"20151124","formatDateTimeAsSQLFormat":"2015-11-24 08:00:00","formatDateTimeAsYYYYMMddHHMM":"201511240800","formatTimeAsHHMM":"0800","json":"new Date(2015,10,24,8,0,0)","jsonForTime":"new Date(1970,0,1,8,0,0)","newDate":false,"timeID":"GMT","timeStamp":1448352000000},"status":"Confirmed","totalPrice":null,"tours":null,"trainResPanelBean":null,"trainReservationNumber":null,"trains":null,"travelAgents":[{"agencyAddress1":"NEW","agencyAddress2":"BOITE POSTALE 69","agencyCityName":"06902 SOPHIA ANTIPOLIS CEDEX","agencyCountryName":"FRANCE","agencyEMail":"DONOTREPLY@AMADEUS.COM","agencyFax":null,"agencyInfoAvailable":true,"agencyName":"AMADEUS APPLICATION DEVELOPMENT - NICE","agencyOpeningHours1":null,"agencyOpeningHours2":null,"agencyPhone":"33.92.94.64.93","generalRemarks":[],"offerConfEmail":"DONOTREPLY@AMADEUS.COM"}],"travelerData":null,"travellers":{"1":{"addressInformationList":[{"city":"06902 SOPHIA ANTIPOLIS CEDEX","cityAttributes":{},"companyName":null,"country":"FRANCE","countryAttributes":{},"filled":true,"firstLine":"NEW","firstLineAttributes":{},"firstName":null,"id":"AGENCY_1","idAttributes":{"list_id":"Y"},"lastName":"AMADEUS APPLICATION DEVELOPMENT - NICE","name":null,"residenceAdress":false,"secondLine":"BOITE POSTALE 69","sendable":false,"state":null,"stateAttributes":null,"type":null,"typeAttributes":null,"zipCode":null,"zipCodeAttributes":null},{"city":"06902 SOPHIA ANTIPOLIS CEDEX","cityAttributes":{},"companyName":null,"country":"FRANCE","countryAttributes":{},"filled":true,"firstLine":"NEW","firstLineAttributes":{},"firstName":null,"id":"AGENCY_2","idAttributes":{"list_id":"Y"},"lastName":"AMADEUS APPLICATION DEVELOPMENT - NICE","name":null,"residenceAdress":false,"secondLine":"BOITE POSTALE 69","sendable":false,"state":null,"stateAttributes":null,"type":null,"typeAttributes":null,"zipCode":null,"zipCodeAttributes":null}],"addressInformationMap":{"AGENCY_1":{"city":"06902 SOPHIA ANTIPOLIS CEDEX","cityAttributes":{},"companyName":null,"country":"FRANCE","countryAttributes":{},"filled":true,"firstLine":"NEW","firstLineAttributes":{},"firstName":null,"id":"AGENCY_1","idAttributes":{"list_id":"Y"},"lastName":"AMADEUS APPLICATION DEVELOPMENT - NICE","name":null,"residenceAdress":false,"secondLine":"BOITE POSTALE 69","sendable":false,"state":null,"stateAttributes":null,"type":null,"typeAttributes":null,"zipCode":null,"zipCodeAttributes":null},"AGENCY_2":{"city":"06902 SOPHIA ANTIPOLIS CEDEX","cityAttributes":{},"companyName":null,"country":"FRANCE","countryAttributes":{},"filled":true,"firstLine":"NEW","firstLineAttributes":{},"firstName":null,"id":"AGENCY_2","idAttributes":{"list_id":"Y"},"lastName":"AMADEUS APPLICATION DEVELOPMENT - NICE","name":null,"residenceAdress":false,"secondLine":"BOITE POSTALE 69","sendable":false,"state":null,"stateAttributes":null,"type":null,"typeAttributes":null,"zipCode":null,"zipCodeAttributes":null}},"airSegmentPreferences":{"1":{"frequentFlyers":null,"mealPreferences":"No special meal","mealStatus":"","seatAssignment":null,"seatLocation":null,"seatStatus":null,"smokingCode":"00"},"2":{"frequentFlyers":null,"mealPreferences":"No special meal","mealStatus":"","seatAssignment":null,"seatLocation":null,"seatStatus":null,"smokingCode":"00"}},"deliveryInformationList":null,"firstName":"Winster","frequentFlyers":null,"frequentFlyersWithNumber":null,"frequentGuests":null,"frequentGuestsWithNumber":null,"frequentRenters":null,"fullName":"Winster Jose","identityInformation":{"addressFirstName":null,"addressId":null,"addressLastName":"AMADEUS APPLICATION DEVELOPMENT - NICE","addressTitleCode":null,"addressTitleName":null,"agencycontact1":null,"agencycontact2":null,"apisLastName":"Jose","apisList":[],"apisSectionBean":null,"apisSortedMap":null,"businessPhone":null,"businessPhoneExtension":null,"businessPhones":{},"businessPhonesCount":0,"contactPointList":[{"code":"E1","description":"wtjose@gmail.com","initialDescription":null,"overseasCode":null}],"contactPointPassengerList":[],"contactPoints":{"E1":{"code":"E1","description":"wtjose@gmail.com","initialDescription":null,"overseasCode":null}},"contactable":null,"currentApis":null,"dateOfBirth":null,"emailList":["wtjose@gmail.com"],"emergencyContactName":null,"emergencyContactPhone":null,"fax":null,"faxes":{},"faxesCount":0,"firstName":"Winster","gender":null,"homePhone":null,"homePhones":{},"homePhonesCount":0,"identityDocumentList":[],"information":null,"lastName":"Jose","middleName":null,"mobilePhone":null,"mobilePhones":{},"mobilePhonesCount":0,"nationality":null,"nationalityAttributes":{"enabled":"N","Default_Value":"","mandatory":"N"},"other":null,"other1":null,"other2":null,"otherPhone":null,"otherPhones":{},"otherPhonesCount":0,"pager":null,"passportInformation":null,"relationCode":null,"relationName":null,"suffix":null,"titleCode":"MR","titleName":"Mr","updated":false,"webFaresAddressCity":null,"webFaresAddressCountry":null,"webFaresAddressFirstline":null,"webFaresAddressSecondline":null,"webFaresAddressZipCode":null,"webFaresState":null},"infant":null,"lastName":"Jose","listRIZRemarks":[],"listRemarks":[],"loginProfileIndex":null,"paxType":{"authorizedToTravelAlone":true,"authorizedToTravelWithInfant":true,"code":"ADT","messageKey":"tx_pltg_text_Adult"},"pnrType":"PR","primaryTraveller":true,"ptNumber":1,"services":null,"tourTravellerId":null,"travellerArranger":false,"travellerId":1,"withInfant":false}},"tripReason":null,"warnings":[]}};
    var recodata = {"model":{"count":69,"endDate":"2015/11/25 00:00:00 GMT+0000","errors":null,"faultyResponse":false,"infos":null,"parameters":null,"recommendations":[{"code":"2356NCE10","currencyCode":"GBP","description":"Spend a day on the beautiful French Riviera with a small-group day trip from Nice to Eze and Monaco. Take a perfumery tour in Eze, see the changing of the guard at the palace in Monte Carlo and do a lap of Monaco's famous Formula One Grand Prix. With your minivan transport taken care of, you can sit back and relax on the scenic drive. This small-group day trip is limited to just eight passengers, ensuring you receive personalized attention.","destinationName":"Nice","duration":"8 hours","endDate":"2015-11-25","location":null,"locationCode":"NCE","maxRate":5,"price":62.43,"priceFormatted":"£62.43","rating":5,"realRatePrice":null,"recloc":"2ZX97P","reviewCount":474,"startDate":"2015-11-25","thumbnailHiResURL":"http://cache-graphicslib.viator.com/graphicslib-prelive/thumbs674x446/2356/SITours/monaco-and-eze-small-group-day-trip-from-nice-in-nice-48425.jpg","thumbnailURL":"http://cache-graphicslib.viator.com/graphicslib-prelive/thumbs154x109/2356/SITours/monaco-and-eze-small-group-day-trip-from-nice-in-nice-48425.jpg","title":"Monaco and Eze Small Group Day Trip from Nice"},{"code":"2356NCE03P","currencyCode":"GBP","description":"Explore southern France in style on this private 8-hour French Riviera day trip from Nice. Travel the coastal road with your guide and soak up spectacular sea views. Discover the medieval village of Èze, home to the Fragonard perfumery. Take a spin along Monaco’s Formula One Grand Prix track then try your hand in the casinos. Browse designer shops and trendy boutiques in Cannes and admire luxury yachts bobbing on the waves in Antibes’ Billionaires’ Quay. With your private guide to show the way, choose your itinerary to suit your interests.","destinationName":"Nice","duration":"8 hours","endDate":"2015-11-25","location":null,"locationCode":"NCE","maxRate":5,"price":51.96,"priceFormatted":"£51.96","rating":5,"realRatePrice":null,"recloc":"2ZX97P","reviewCount":8,"startDate":"2015-11-25","thumbnailHiResURL":"http://cache-graphicslib.viator.com/graphicslib-prelive/thumbs674x446/2356/SITours/private-day-trip-the-french-riviera-from-nice-by-minivan-in-nice-123547.jpg","thumbnailURL":"http://cache-graphicslib.viator.com/graphicslib-prelive/thumbs154x109/2356/SITours/private-day-trip-the-french-riviera-from-nice-by-minivan-in-nice-123547.jpg","title":"Private Day Trip: The French Riviera from Nice"},{"code":"2356NCE01","currencyCode":"GBP","description":"Enjoy Monaco’s glamorous atmosphere on a small-group evening dinner tour from Nice. You’ll drive along the seaside corniche to Monte Carlo, where elegant architecture, amazing cars and beautiful people collide on the Mediterranean coast. Tour the Grand Prix circuit, enjoy a 3-course dinner and have free time to explore Monte Carlo at your leisure. <br><br>Numbers are limited to a maximum of eight people on this small-group tour, ensuring you'll receive personalized attention from your English-speaking guide.","destinationName":"Nice","duration":"5 hours","endDate":"2015-11-25","location":null,"locationCode":"NCE","maxRate":5,"price":111.71,"priceFormatted":"£111.71","rating":4,"realRatePrice":null,"recloc":"2ZX97P","reviewCount":119,"startDate":"2015-11-25","thumbnailHiResURL":"http://cache-graphicslib.viator.com/graphicslib-prelive/thumbs674x446/2356/SITours/small-group-evening-tour-and-dinner-in-monte-carlo-from-nice-in-nice-123546.jpg","thumbnailURL":"http://cache-graphicslib.viator.com/graphicslib-prelive/thumbs154x109/2356/SITours/small-group-evening-tour-and-dinner-in-monte-carlo-from-nice-in-nice-123546.jpg","title":"Small-Group Evening Tour and Dinner in Monte Carlo from Nice"},{"code":"5419MONACONICEPRT","currencyCode":"GBP","description":"<div>Take advantage of your time in port in Villefranche, near Nice, by discovering two gems of the French Riviera: Eze and Monaco. On this small-group shore excursion, visit the picturesque village of Eze for a guided tour of the Fragonard perfumery. Then enter glitzy Monaco to watch the Changing of the Guard ceremony at the Prince's Palace, drive along the world-famous Formula One Grand Prix race circuit and visit Monte Carlo’s Casino Square.<\/div><div><br><\/div><div>This small-group morning or afternoon tour is limited to eight people, ensuring you'll receive personalized attention from your guide.<\/div>","destinationName":"Nice","duration":"4 hours","endDate":"2015-11-25","location":null,"locationCode":"NCE","maxRate":5,"price":42.8,"priceFormatted":"£42.80","rating":5,"realRatePrice":null,"recloc":"2ZX97P","reviewCount":19,"startDate":"2015-11-25","thumbnailHiResURL":"http://cache-graphicslib.viator.com/graphicslib-prelive/thumbs674x446/5419/SITours/villefranche-shore-excursion-small-group-monaco-and-eze-half-day-tour-in-nice-153556.jpg","thumbnailURL":"http://cache-graphicslib.viator.com/graphicslib-prelive/thumbs154x109/5419/SITours/villefranche-shore-excursion-small-group-monaco-and-eze-half-day-tour-in-nice-153556.jpg","title":"Villefranche Shore Excursion: Monaco and Eze Tour"},{"code":"2356NCE03","currencyCode":"GBP","description":"From Monte Carlo to Cannes you'll see all the fabulous towns of the French Riviera on this small-group day trip from Nice. You’ll delight in the scenic drive along the famous Mediterranean coastal road, as the sparkling blue sea shines, dotted with white yachts. Your journey takes in the designer shops of Cannes, trendy boutiques in Juan-les-Pins and the royal palace in Monte Carlo. This small-group tour is limited to eight passengers, ensuring a personalized experience.","destinationName":"Nice","duration":"9 hours","endDate":"2015-11-25","location":null,"locationCode":"NCE","maxRate":5,"price":74.72,"priceFormatted":"£74.72","rating":4.5,"realRatePrice":null,"recloc":"2ZX97P","reviewCount":327,"startDate":"2015-11-25","thumbnailHiResURL":"http://cache-graphicslib.viator.com/graphicslib-prelive/thumbs674x446/2356/SITours/french-riviera-small-group-day-trip-from-nice-in-nice-48414.jpg","thumbnailURL":"http://cache-graphicslib.viator.com/graphicslib-prelive/thumbs154x109/2356/SITours/french-riviera-small-group-day-trip-from-nice-in-nice-48414.jpg","title":"French Riviera Small Group Day Trip from Nice"},{"code":"5419P62","currencyCode":"GBP","description":"On the way to Monaco, enjoy the panoramic drive along the coast, over Nice, Villefranche Bay, and Monaco. Stop in Eze to visit this amazing medieval village and learn about the whole process of perfume with Fragonard. After a drive through the village of la Turbie and its 2000 years old monument, the Trophy of the Alps, you will reach the Principality. Discover the Casino square of Monte-Carlo with luxury shops and cars.<br>Take a ride on the Formula 1 circuit and reach the old town. Stroll in the tiny streets, see the changing of guards (11.55 am), visit the Oceanographic museum, the Prince’s Palace, and the Cathedral. This small-group excursion is limited to eight people, ensuring you’ll receive personalized attention from your guide.","destinationName":"Nice","duration":"7 hours","endDate":"2015-11-25","location":null,"locationCode":"NCE","maxRate":5,"price":57.31,"priceFormatted":"£57.31","rating":0,"realRatePrice":null,"recloc":"2ZX97P","reviewCount":0,"startDate":"2015-11-25","thumbnailHiResURL":"http://cache-graphicslib.viator.com/graphicslib-prelive/thumbs674x446/5419/SITours/small-group-day-tour-to-monaco-monte-carlo-from-nice-including-stops-in-nice-195244.jpg","thumbnailURL":"http://cache-graphicslib.viator.com/graphicslib-prelive/thumbs154x109/5419/SITours/small-group-day-tour-to-monaco-monte-carlo-from-nice-including-stops-in-nice-195244.jpg","title":"Small-Group Day Tour to Monaco Monte-Carlo"},{"code":"10175P1","currencyCode":"GBP","description":"Discover the best of the French Riviera: Nice, Eze, Monaco Monte Carlo, Cannes, Antibes and St. Paul de Vence.","destinationName":"Nice","duration":"9 hours","endDate":"2015-11-25","location":null,"locationCode":"NCE","maxRate":5,"price":58.03,"priceFormatted":"£58.03","rating":4.5,"realRatePrice":null,"recloc":"2ZX97P","reviewCount":3,"startDate":"2015-11-25","thumbnailHiResURL":"http://cache-graphicslib.viator.com/graphicslib-prelive/thumbs674x446/10175/SITours/french-riviera-day-trip-from-nice-in-nice-199026.jpg","thumbnailURL":"http://cache-graphicslib.viator.com/graphicslib-prelive/thumbs154x109/10175/SITours/french-riviera-day-trip-from-nice-in-nice-199026.jpg","title":"French Riviera Day Trip from Nice"},{"code":"2356NCE02","currencyCode":"GBP","description":"Discover the glitz and glamour of the Mediterranean coast on this 4-hour Cannes and Antibes half-day trip from Nice. In Cannes — city of festivals, fireworks and film stars — stroll along the sun-drenched Croisette Boulevard to the Film Festival Palace and see famous stars’ hand prints. Explore sites of beauty such as Juan-les-Pins, La Garoupe and Cap d'Antibes. Mingle with the stylish locals in seaside Antibes and explore the beaches and boutiques at your leisure. Your tour size is limited to eight to ensure a more personalized experience.","destinationName":"Nice","duration":"4 hours","endDate":"2015-11-25","location":null,"locationCode":"NCE","maxRate":5,"price":45.7,"priceFormatted":"£45.70","rating":4,"realRatePrice":null,"recloc":"2ZX97P","reviewCount":34,"startDate":"2015-11-25","thumbnailHiResURL":"http://cache-graphicslib.viator.com/graphicslib-prelive/thumbs674x446/2356/SITours/cannes-and-antibes-small-group-half-day-trip-from-nice-in-nice-182503.jpg","thumbnailURL":"http://cache-graphicslib.viator.com/graphicslib-prelive/thumbs154x109/2356/SITours/cannes-and-antibes-small-group-half-day-trip-from-nice-in-nice-182503.jpg","title":"Cannes and Antibes Half Day Trip from Nice"},{"code":"5294NICE","currencyCode":"GBP","description":"Enjoy the best of Nice on a bike tour with a local guide. This is an extraordinary opportunity to experience Nice as not many do! You will cycle along stunning beaches, grand streets and majestic plazas. Discover hidden Baroque churches, awe-inspiring Belle Époque palaces, super-cool bars and bistros, and winding medieval alleyways. The Nice City Bike Tour will take you from the chic hangouts of modern film stars to the haunts of prehistoric man.","destinationName":"Nice","duration":"3 hours","endDate":"2015-11-25","location":null,"locationCode":"NCE","maxRate":5,"price":21.76,"priceFormatted":"£21.76","rating":5,"realRatePrice":null,"recloc":"2ZX97P","reviewCount":103,"startDate":"2015-11-25","thumbnailHiResURL":"http://cache-graphicslib.viator.com/graphicslib-prelive/thumbs674x446/5294/SITours/nice-city-bike-tour-in-nice-48736.jpg","thumbnailURL":"http://cache-graphicslib.viator.com/graphicslib-prelive/thumbs154x109/5294/SITours/nice-city-bike-tour-in-nice-48736.jpg","title":"Nice City Bike Tour"},{"code":"2356NCE09","currencyCode":"GBP","description":"Discover the glitz and glamour of the French Riviera on this 5-hour Monaco night tour from Nice. Drive out along the high coastal road and enjoy panoramic views over the rugged landscape below. Take a spin along Monaco’s Formula One Grand Prix circuit with your guide. Rub shoulders with the rich and famous during your free time, then visit the famous Monte Carlo Casino and try your hand at the card tables and slot machines. Enjoy personal attention from your guide on this small-group tour, limited to eight people.","destinationName":"Nice","duration":"5 hours","endDate":"2015-11-25","location":null,"locationCode":"NCE","maxRate":5,"price":42.8,"priceFormatted":"£42.80","rating":4.5,"realRatePrice":null,"recloc":"2ZX97P","reviewCount":40,"startDate":"2015-11-25","thumbnailHiResURL":"http://cache-graphicslib.viator.com/graphicslib-prelive/thumbs674x446/2356/SITours/monaco-small-group-night-tour-from-nice-in-nice-48423.jpg","thumbnailURL":"http://cache-graphicslib.viator.com/graphicslib-prelive/thumbs154x109/2356/SITours/monaco-small-group-night-tour-from-nice-in-nice-48423.jpg","title":"Monaco Small-Group Night Tour from Nice"}],"startDate":"2015/11/25 00:00:00 GMT+0000","supportedCurrencies":"EUR,CAD,GBP,NZD,USD,AUD","warnings":null}};

    return {    
        retrieveTrip : function(req, rCb, sCb, cache) {
            var retrieveTripCb = function(result){
                var data = result.firstChild ? 
                    result.firstChild.children && result.firstChild.children.length==2 ?
                        result.firstChild.children[1].textContent :null :null;
                data = data ?JSON.parse(data) :null;
                setData('trip', data);
                rCb(data);
            };
            var formData = "data="+JSON.stringify(req);
            if(!isApp()) 
                rCb(tripdata);
            else
                xhr('POST', {'Content-Type':'application/x-www-form-urlencoded'}, reqUrl("retrieve",req), formData, retrieveTripCb, sCb);
        },
        getRecommendationActivities : function(req, rCb, sCb){
            var recoActCb = function(result){
                var data = result.firstChild ? 
                    result.firstChild.children && result.firstChild.children.length==2 ?
                        result.firstChild.children[1].textContent :null :null;
                data = data ?JSON.parse(data) :null;
                setData('recoActs', data);
                rCb(data);
            };
            var r={};
            r.destination={};
            r.type='ACT';
            r.userCountry=req.userCountry;
            r.recloc=req.recLoc;
            r.currency=req.currency;
            r.departureDateTime=req.departureDateTime;
            r.arrivalDateTime=req.arrivalDateTime;
            r.destination.cityCode=req.destinationCityCode;
            r.destination.cityName=req.destinationCityName;
            r.destination.countryCode=req.destinationCountryCode;

            var formData = "data="+JSON.stringify(r);
            if(!isApp()) 
                rCb(recodata);
            else
                xhr('POST', {'Content-Type':'application/x-www-form-urlencoded'}, reqUrl("reco", {reco:true}), formData, recoActCb, sCb);
        }
    }
}; 